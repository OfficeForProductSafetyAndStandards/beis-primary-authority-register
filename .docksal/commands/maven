#!/usr/bin/env bash

## Runs maven to run the Gherkin based tests
##
## Usage: fin maven

# Stop the maven container if it is running.
fin project stop maven;

# Copy the resources files from the main project to the maven container.
rm -f .docksal/services/maven/resources/shared-driver.properties
cp tests/e2e/par-test-automation/src/main/resources/shared-driver.properties .docksal/services/maven/resources/shared-driver.properties

# Copy and patch the tests pom.xml to run here
rm -f .docksal/services/maven/pom.xml
cp tests/e2e/par-test-automation/pom.xml .docksal/services/maven
git apply .docksal/services/maven/maven-pom.patch

# Cleanup the test files generated by the tests.
fin reset_for_tests;

# Run the maven docker container.
fin project start maven;

# Wait for the tests to end.
fin logs -f maven;

# Copy the results from the maven container to the host.
rm -fr target;
docker export ${COMPOSE_PROJECT_NAME_SAFE}_maven_1 | tar -xvf - target;
