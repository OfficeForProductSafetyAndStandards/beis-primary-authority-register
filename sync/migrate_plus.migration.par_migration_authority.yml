uuid: 039026b1-7f9e-420f-ae8e-637f7cd95eec
langcode: en
status: true
dependencies:
  enforced:
    module:
      - par_migration
      - par_migration_scripts
_core:
  default_config_hash: NQm7kQA_vsKNTDvfUT8cg8vtJinMrlV8BMG4jPrkQl0
id: par_migration_authority
class: null
field_plugin_method: null
cck_plugin_method: null
migration_tags:
  - MS-SQL
migration_group: PAR2
label: 'PAR Migration of authority'
source:
  plugin: par_migration_authority
process:
  id: authority_id
  type:
    plugin: default_value
    default_value: authority
  uid:
    plugin: default_value
    default_value: 1
  authority_name:
    plugin: skip_on_empty
    method: process
    source: name
  authority_type:
    -
      plugin: skip_on_empty
      method: process
      source: authority_type
    -
      plugin: static_map
      map:
        County: county
        District: district
        'District Council Area': district_council
        'Fire Authority': fire_auhority
        'Joint Services': joint_services
        'London Borough': london_borough
        'Metropolitan District': metropolitan_district
        Port: port
        Unitary: unitary
        Other: other
  nation:
    -
      plugin: skip_on_empty
      method: process
      source: country
    -
      plugin: static_map
      map:
        England: GB-ENG
        Wales: GB-WLS
        Scotland: GB-SCT
        'Northern Ireland': GB-NIR
  ons_code:
    plugin: skip_on_empty
    method: process
    source: ons_code
  comments:
    plugin: skip_on_empty
    method: process
    source: comments
  field_regulatory_function:
    -
      plugin: skip_on_empty
      method: process
      source: regulatory_functions
    -
      plugin: iterator
      process:
        target_id:
          plugin: migration_lookup
          migration: par_migration_regulatory_functions
          source: target_id
          no_stub: true
  field_person:
    -
      plugin: migration_lookup
      migration: par_migration_authority_person
      no_stub: true
      source:
        person_id: null
        authority_id: authority_id
    -
      plugin: skip_on_empty
      method: process
  field_premises:
    -
      plugin: migration_lookup
      migration: par_migration_authority_premises
      no_stub: true
      source:
        premises_id: null
        authority_id: authority_id
    -
      plugin: skip_on_empty
      method: process
destination:
  plugin: 'entity:par_data_authority'
migration_dependencies:
  required:
    - par_migration_authority_person
    - par_migration_authority_premises
    - par_migration_regulatory_functions
