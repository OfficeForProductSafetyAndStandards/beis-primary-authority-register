uuid: d7038622-2bd9-41be-a992-02bc4749735c
langcode: en
status: true
dependencies:
  enforced:
    module:
      - par_migration
      - par_migration_scripts
_core:
  default_config_hash: Oc0aSQNEUtJs1IHAvf3q22NZp-jC3tN35Dp-ujecUmQ
id: par_migration_partnership
class: null
field_plugin_method: null
cck_plugin_method: null
migration_tags:
  - MS-SQL
migration_group: PAR2
label: 'PAR Migration of partnership'
source:
  plugin: par_migration_partnership
process:
  id: partnership_id
  type:
    plugin: default_value
    default_value: partnership
  uid:
    plugin: default_value
    default_value: 1
  partnership_type:
    -
      plugin: skip_on_empty
      method: process
      source: partnership_type
    -
      plugin: static_map
      map:
        Co-ordinated: 'coordinated:'
        Direct: direct
  partnership_status:
    plugin: default_value
    default_value: awaiting_review
  about_partnership:
    plugin: skip_on_empty
    method: process
    source: about_partnership
  approved_date/value:
    -
      plugin: explode
      source: approved_date
      delimiter: ' '
    -
      plugin: extract
      index:
        - '0'
    -
      plugin: format_date
      from_format: Y-m-d
      to_format: Y-m-d
  cost_recovery:
    plugin: skip_on_empty
    method: process
    source: cost_recovery
  reject_comment:
    plugin: skip_on_empty
    method: process
    source: reject_comment
  revocation_source:
    plugin: skip_on_empty
    method: process
    source: revocation_source
  revocation_reason:
    plugin: skip_on_empty
    method: process
    source: revocation_reason
  revocation_date/value:
    -
      plugin: explode
      source: revocation_date
      delimiter: ' '
    -
      plugin: extract
      index:
        - '0'
    -
      plugin: format_date
      from_format: Y-m-d
      to_format: Y-m-d
  authority_change_comment:
    plugin: skip_on_empty
    method: process
    source: authority_change_comment
  organisation_change_comment:
    plugin: skip_on_empty
    method: process
    source: organisation_change_comment
  coordinator_suitable:
    -
      plugin: skip_on_empty
      method: process
      source: coordinator_suitable
    -
      plugin: static_map
      default_value: false
      map:
        'Y': true
        'N': false
  partnership_info_agreed_authority:
    -
      plugin: skip_on_empty
      method: process
      source: organisation_info_confirmed
    -
      plugin: static_map
      default_value: false
      map:
        'Y': true
        'N': false
  partnership_info_agreed_business:
    -
      plugin: skip_on_empty
      method: process
      source: authority_info__confirmed
    -
      plugin: static_map
      default_value: false
      map:
        'Y': true
        'N': false
  written_summary_agreed:
    -
      plugin: skip_on_empty
      method: process
      source: written_summary_agreed
    -
      plugin: static_map
      default_value: false
      map:
        'Y': true
        'N': false
  field_authority:
    -
      plugin: migration_lookup
      migration: par_migration_authority
      no_stub: true
      source: authority_id
  field_organisation:
    -
      plugin: migration_lookup
      migration:
        - par_migration_business_organisation
        - par_migration_coordinator_organisation
      no_stub: true
      source_ids:
        par_migration_business_organisation:
          - organisation_id
        par_migration_coordinator_organisation:
          - organisation_id
  field_advice:
    -
      plugin: migration_lookup
      migration: par_migration_advice
      no_stub: true
      source:
        advice_id: null
        partnership_id: partnership_id
    -
      plugin: skip_on_empty
      method: process
  field_inspection_plan:
    -
      plugin: migration_lookup
      migration: par_migration_inspection_plan
      no_stub: true
      source:
        inspection_plan_id: null
        partnership_id: partnership_id
    -
      plugin: skip_on_empty
      method: process
  field_regulatory_function:
    -
      plugin: skip_on_empty
      method: process
      source: regulatory_functions
    -
      plugin: iterator
      process:
        -
          plugin: migration_lookup
          migration: par_migration_regulatory_functions
          no_stub: true
destination:
  plugin: 'entity:par_data_authority'
migration_dependencies:
  required:
    - par_migration_authority
    - par_migration_business_organisation
    - par_migration_coordinator_organisation
    - par_migration_authority_person
    - par_migration_authority_premises
    - par_migration_regulatory_functions
    - par_migration_legal_entity
    - par_migration_advice
    - migrate_plus.migration.par_migration_inspection_plan.yml
